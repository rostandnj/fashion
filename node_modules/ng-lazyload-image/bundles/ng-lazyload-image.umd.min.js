!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@angular/core"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("ng-lazyload-image",["exports","@angular/common","@angular/core","rxjs","rxjs/operators"],t):t((e=e||self)["ng-lazyload-image"]={},e.ng.common,e.ng.core,e.rxjs,e.rxjs.operators)}(this,(function(e,t,n,r,o){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function i(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}function a(e,t){return function(n,r){t(n,r,e)}}var s="ng-lazyloaded",u="ng-lazyloading",c="ng-failed-lazyloaded";function l(e,t){e.className=e.className.replace(t,"")}function f(e,t){e.className.includes(t)||(e.className+=" "+t)}function p(){return"undefined"!=typeof window?window.navigator:void 0}function g(e){return Boolean(e.parentElement&&"picture"===e.parentElement.nodeName.toLowerCase())}function m(e){return"img"===e.nodeName.toLowerCase()}function d(e,t,n){return m(e)?n&&"srcset"in e?e.srcset=t:e.src=t:e.style.backgroundImage="url('"+t+"')",e}function h(e){return function(t){for(var n=t.parentElement.getElementsByTagName("source"),r=0;r<n.length;r++){var o=n[r].getAttribute(e);o&&("srcset"in n[r]?n[r].srcset=o:n[r].src=o)}}}var b=h("defaultImage"),v=h("lazyLoad"),y=h("errorImage");function I(e){return function(t,n,r){m(t)&&g(t)&&e(t),n&&d(t,n,r)}}var O=I(b),w=I(v),S=I(y),C=function(e){var t=e.element;f(t,s),l(t,u)},j=function(e){var t=e.element,n=e.errorImagePath,r=e.useSrcset;S(t,n,r),f(t,c)},E=function(e){var t=e.element,n=e.imagePath,r=e.useSrcset;w(t,n,r)},L=function(e){var t=e.element,n=e.defaultImagePath,r=e.useSrcset;O(t,n,r),f(t,u),function(e,t){return e.className&&e.className.includes(t)}(t,s)&&l(t,s)},P={finally:C,loadImage:function(e){var t,n=e.element,r=e.useSrcset,o=e.imagePath,i=e.decode;if(m(n)&&g(n)){var a=n.parentNode.cloneNode(!0);t=a.getElementsByTagName("img")[0],v(t),d(t,o,r)}else t=new Image,m(n)&&n.sizes&&(t.sizes=n.sizes),r&&"srcset"in t?t.srcset=o:t.src=o;return i&&t.decode?t.decode().then((function(){return o})):new Promise((function(e,n){t.onload=function(){return e(o)},t.onerror=function(){return n(null)}}))},setErrorImage:j,setLoadedImage:E,setup:L,isBot:function(e){return!(!e||!e.userAgent)&&/googlebot|bingbot|yandex|baiduspider|facebookexternalhit|twitterbot|rogerbot|linkedinbot|embedly|quora\ link\ preview|showyoubot|outbrain|pinterest\/0\.|pinterestbot|slackbot|vkShare|W3C_Validator|whatsapp|duckduckbot/i.test(e.userAgent)}},k=new WeakMap,x=new r.Subject;function z(e){e.forEach((function(e){return x.next(e)}))}var M={},N=function(e){var t=e.scrollContainer||M,n={root:e.scrollContainer||null};e.offset&&(n.rootMargin=e.offset+"px");var i=k.get(t);return i||(i=new IntersectionObserver(z,n),k.set(t,i)),i.observe(e.element),r.Observable.create((function(t){var n=x.pipe(o.filter((function(t){return t.target===e.element}))).subscribe(t);return function(){n.unsubscribe(),i.unobserve(e.element)}}))},W=Object.assign({},P,{isVisible:function(e){return e.event.isIntersecting},getObservable:function(e,t){return void 0===t&&(t=N),e.customObservable?e.customObservable:t(e)}}),R=function(){return!0},B=function(){return r.of("load")},T=function(e){return[e.imagePath]},A=Object.assign({},P,{isVisible:R,getObservable:B,loadImage:T});var D=function(){function e(e,t,o,i){this.onStateChange=new n.EventEmitter,this.onLoad=new n.EventEmitter,this.elementRef=e,this.ngZone=t,this.propertyChanges$=new r.ReplaySubject,this.platformId=o,this.hooks=function(e,t){var n=W,r=t&&t.isBot?t.isBot:n.isBot;if(r(p(),e))return Object.assign(A,{isBot:r});if(!t)return n;var o={};return t.preset?Object.assign(o,t.preset):Object.assign(o,n),Object.keys(t).filter((function(e){return"preset"!==e})).forEach((function(e){o[e]=t[e]})),o}(o,i)}return e.prototype.ngOnChanges=function(){!0!==this.debug||this.debugSubscription||(this.debugSubscription=this.onStateChange.subscribe((function(e){return console.log(e)}))),this.propertyChanges$.next({element:this.elementRef.nativeElement,imagePath:this.lazyImage,defaultImagePath:this.defaultImage,errorImagePath:this.errorImage,useSrcset:this.useSrcset,offset:this.offset?0|this.offset:0,scrollContainer:this.scrollTarget,customObservable:this.customObservable,decode:this.decode,onStateChange:this.onStateChange})},e.prototype.ngAfterContentInit=function(){var e=this;if(t.isPlatformServer(this.platformId)&&!this.hooks.isBot(p(),this.platformId))return null;this.ngZone.runOutsideAngular((function(){e.loadSubscription=e.propertyChanges$.pipe(o.tap((function(e){return e.onStateChange.emit({reason:"setup"})})),o.tap((function(t){return e.hooks.setup(t)})),o.switchMap((function(t){return t.imagePath?e.hooks.getObservable(t).pipe(function(e,t){return function(n){return n.pipe(o.tap((function(e){return t.onStateChange.emit({reason:"observer-emit",data:e})})),o.filter((function(n){return e.isVisible({element:t.element,event:n,offset:t.offset,scrollContainer:t.scrollContainer})})),o.take(1),o.tap((function(){return t.onStateChange.emit({reason:"start-loading"})})),o.mergeMap((function(){return e.loadImage(t)})),o.tap((function(){return t.onStateChange.emit({reason:"mount-image"})})),o.tap((function(n){return e.setLoadedImage({element:t.element,imagePath:n,useSrcset:t.useSrcset})})),o.tap((function(){return t.onStateChange.emit({reason:"loading-succeeded"})})),o.map((function(){return!0})),o.catchError((function(n){return t.onStateChange.emit({reason:"loading-failed",data:n}),e.setErrorImage(t),r.of(!1)})),o.tap((function(){t.onStateChange.emit({reason:"finally"}),e.finally(t)})))}}(e.hooks,t)):r.never()}))).subscribe((function(t){return e.onLoad.emit(t)}))}))},e.prototype.ngOnDestroy=function(){var e,t;null===(e=this.loadSubscription)||void 0===e||e.unsubscribe(),null===(t=this.debugSubscription)||void 0===t||t.unsubscribe()},e.ctorParameters=function(){return[{type:n.ElementRef},{type:n.NgZone},{type:Object,decorators:[{type:n.Inject,args:[n.PLATFORM_ID]}]},{type:void 0,decorators:[{type:n.Optional},{type:n.Inject,args:["options"]}]}]},i([n.Input("lazyLoad")],e.prototype,"lazyImage",void 0),i([n.Input()],e.prototype,"defaultImage",void 0),i([n.Input()],e.prototype,"errorImage",void 0),i([n.Input()],e.prototype,"scrollTarget",void 0),i([n.Input()],e.prototype,"customObservable",void 0),i([n.Input()],e.prototype,"offset",void 0),i([n.Input()],e.prototype,"useSrcset",void 0),i([n.Input()],e.prototype,"decode",void 0),i([n.Input()],e.prototype,"debug",void 0),i([n.Output()],e.prototype,"onStateChange",void 0),i([n.Output()],e.prototype,"onLoad",void 0),e=i([n.Directive({selector:"[lazyLoad]"}),a(2,n.Inject(n.PLATFORM_ID)),a(3,n.Optional()),a(3,n.Inject("options"))],e)}(),V=function(){function e(){}var t;return t=e,e.forRoot=function(e){return{ngModule:t,providers:[{provide:"options",useValue:e}]}},e=t=i([n.NgModule({declarations:[D],exports:[D]})],e)}(),q=function(){function e(e,t,n,r){this.left=e,this.top=t,this.right=n,this.bottom=r}return e.fromElement=function(t){var n=t.getBoundingClientRect(),r=n.left,o=n.top,i=n.right,a=n.bottom;return 0===r&&0===o&&0===i&&0===a?e.empty:new e(r,o,i,a)},e.fromWindow=function(t){return new e(0,0,t.innerWidth,t.innerHeight)},e.prototype.inflate=function(e){this.left-=e,this.top-=e,this.right+=e,this.bottom+=e},e.prototype.intersectsWith=function(e){return e.left<this.right&&this.left<e.right&&e.top<this.bottom&&this.top<e.bottom},e.prototype.getIntersectionWith=function(t){var n=Math.max(this.left,t.left),r=Math.max(this.top,t.top),o=Math.min(this.right,t.right),i=Math.min(this.bottom,t.bottom);return o>=n&&i>=r?new e(n,r,o,i):e.empty},e.empty=new e(0,0,0,0),e}(),_=new WeakMap;var Z=function(e){if(!e||"function"!=typeof e.addEventListener)return console.warn("`addEventListener` on "+e+" (scrollTarget) is not a function. Skipping this target"),r.empty();var t=_.get(e);if(t)return t;var n,i=r.Observable.create((function(t){var n=function(e){return t.next(e)},r={passive:!0,capture:!1};return e.addEventListener("scroll",n,r),function(){return e.removeEventListener("scroll",n,r)}})),a=i.pipe(o.sampleTime(100,n),o.share(),o.startWith(""));return _.set(e,a),a},$=function(e){return e.customObservable?e.customObservable.pipe(o.startWith("")):e.scrollContainer?Z(e.scrollContainer):Z(window)},F=Object.assign({},P,{isVisible:function(e,t){var n=e.element,r=e.offset,o=e.scrollContainer;void 0===t&&(t=function(){return window});var i=q.fromElement(n);if(i===q.empty)return!1;var a=q.fromWindow(t());if(i.inflate(r),o){var s=q.fromElement(o).getIntersectionWith(a);return i.intersectsWith(s)}return i.intersectsWith(a)},getObservable:$});e.LazyLoadImageDirective=D,e.LazyLoadImageModule=V,e.intersectionObserverPreset=W,e.scrollPreset=F,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ng-lazyload-image.umd.min.js.map